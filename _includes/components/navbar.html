<nav id="navbar" class="relative fixed top-0 w-full z-50 transition-all duration-300 ease-in-out ">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
          <!-- Logo -->
          <a href="/">
              <div id="logo" class=" flex-shrink-0">
                  <div class="logo-preview">
                      <img src="{{ '/assets/images/logo.png' }}" alt="Logo Prévision Web" class="w-[200px] max-w-[380px]">
                  </div>
              </div>
          </a>

          <!-- Desktop Navigation -->
          <div class="hidden lg:flex items-center space-x-8">
              <div class="flex items-baseline space-x-4">
                {% for item in site.data.menu %}
                  {% assign is_current = false %}
                  {% assign is_parent_active = false %}

                  <!-- Vérifier si c'est la page actuelle ou un sous-menu actuel -->
                  {% if page.permalink == item.url %}
                    {% assign is_current = true %}
                  {% endif %}

                  {% if item.sub_nav %}
                    {% for sub_item in item.sub_nav %}
                      {% if page.permalink == sub_item.url %}
                        {% assign is_parent_active = true %}
                        {% break %}
                      {% endif %}
                    {% endfor %}
                  {% endif %}

                  {% if item.sub_nav %}

                    <!-- Menu avec sous-menu -->
                    <div class="relative group">
                        <a href="{{ item.url }}"
                        class="nav-link px-3 py-2 text-sm tracking-[1px] transition-colors border-b-2 flex items-center gap-1 group-hover:border-primary
                        {% if is_current %}
                           border-primary
                        {% elsif is_parent_active %}
                           border-secondary
                        {% else %}
                            border-transparent hover:border-primary
                        {% endif %}">
                          {{ item.name }}
                          <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                          </svg>
                        </a>

                      <!-- Sous-menu avec état actif -->
                      <div class="absolute left-0 top-full pt-2 min-w-[180px] z-30 hidden group-hover:block">
                        <div class="bg-white shadow-lg py-2">
                          {% for sub_item in item.sub_nav %}
                            {% assign is_sub_current = false %}
                            {% if page.permalink == sub_item.url %}
                              {% assign is_sub_current = true %}
                            {% endif %}

                            <a href="{{ sub_item.url }}"
                              class="block px-4 py-2 transition-colors border-b-2
                              {% if is_sub_current %}
                                  bg-secondary/40 border-secondary
                              {% else %}
                                 border-transparent hover:border-secondary hover:bg-secondary/20
                              {% endif %}">
                              {{ sub_item.name }}
                            </a>
                          {% endfor %}
                        </div>
                      </div>
                    </div>

                  {% else %}
                    <!-- Menu simple sans sous-menu -->
                    <a href="{{ item.url }}"
                      class="nav-link px-3 py-2 text-sm tracking-[1px] transition-colors border-b-2
                      {% if is_current %}
                           border-primary
                      {% else %}
                            border-transparent hover:border-primary
                      {% endif %}">
                      {{ item.name }}
                    </a>
                  {% endif %}
                {% endfor %}
              </div>

              <!-- Réseaux sociaux desktop -->
              <div class="flex items-center space-x-3 border-l pl-6">

                  {% include components/instagram.svg.html %}
              </div>
          </div>

          <!-- Mobile menu button -->
          <div class="lg:hidden">
            <details type="button"
                    class=" group ">
              <summary class="marker:hidden cursor-pointer list-none" aria-label="Menu de navigation">
                <svg class="h-6 w-6 transition-transform group-open:rotate-90" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                </svg>
              </summary>

              <!-- Mobile Navigation -->
              <div class="absolute left-0 top-full w-screen bg-white shadow-lg z-40
              transform translate-x-full group-open:translate-x-0
              transition-transform duration-300 ease-in-out">
                <div class=" px-2  pb-3 space-y-1 sm:px-3 bg-white border-t">
                  {% for item in site.data.menu %}
                    {% assign is_current = false %}
                    {% assign is_parent_active = false %}

                    {% if page.permalink == item.url %}
                        {% assign is_current = true %}
                    {% endif %}

                    {% if item.sub_nav %}
                        {% for sub_item in item.sub_nav %}
                            {% if page.permalink == sub_item.url %}
                                {% assign is_parent_active = true %}
                                {% break %}
                            {% endif %}
                        {% endfor %}
                    {% endif %}

                    {% if item.sub_nav %}
                        <!-- Menu mobile avec sous-menu -->
                        <div>

                          <a href="{{ item.url }}"
                            class="block px-3 py-2 text-base font-medium border-l-4 active:bg-secondary/40
                            {% if is_current %}
                                border-primary
                            {% elsif is_parent_active %}
                                border-secondary
                            {% else %}
                                border-transparent
                            {% endif %}">
                              {{ item.name }}
                          </a>

                          <div class="ml-4 space-y-1">
                            {% for sub_item in item.sub_nav %}
                              {% assign is_sub_current = false %}
                              {% if page.permalink == sub_item.url %}
                                {% assign is_sub_current = true %}
                              {% endif %}

                              <a href="{{ sub_item.url }}"
                                class="block px-3 py-2 border-l-2 active:bg-secondary/40
                                {% if is_sub_current %}
                                    border-secondary bg-secondary/40
                                {% else %}
                                    border-transparent
                                {% endif %}">
                                  {{ sub_item.name }}
                              </a>
                            {% endfor %}
                          </div>
                        </div>

                    {% else %}

                      <!-- Menu mobile simple -->
                      <a href="{{ item.url }}"
                        class="block px-3 py-2 text-base font-medium border-l-4 active:bg-secondary/40
                        {% if is_current %}
                            border-primary
                        {% else %}
                            border-transparent
                        {% endif %}">
                          {{ item.name }}
                      </a>
                    {% endif %}
                  {% endfor %}


            <!-- Réseaux sociaux mobile -->
            <div class="border-t pt-4 mt-4">
                <p class="text-sm font-medium px-3 mb-3">Suivez-moi</p>
                <div class="flex space-x-16 px-3">

                    {% include components/instagram.svg.html %}
                </div>
            </div>
        </div>
    </div>
            </details>
          </div>
      </div>
    </div>

</nav>
